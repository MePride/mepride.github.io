

<!DOCTYPE html>
<html lang="zh-CN" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Pride">

    <title>基于okhttp模拟登陆青果教务系统 - Pride&#39;s Life</title>
    <meta name="description" content="">

    <meta name="keywords"
          content="">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <noscript>
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400|Montserrat|Anonymous+Pro:400|Material+Icons"/>
    </noscript>
    <link rel="short icon" href="/favicon/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/mprogress.css">
    <link rel="stylesheet" href="/css/open-iconic.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml">
    <script>
        /*!
         loadCSS: load a CSS file asynchronously.
         [c]2014 @scottjehl, Filament Group, Inc.
         Licensed MIT
         */
        function loadCSS( href, before, media ){
            "use strict";
            var ss = window.document.createElement( "link" );
            var ref = before || window.document.getElementsByTagName( "script" )[ 0 ];
            var sheets = window.document.styleSheets;
            ss.rel = "stylesheet";
            ss.href = href;
            ss.media = "only x";
            ref.parentNode.insertBefore( ss, ref );
            function toggleMedia(){
                var defined;
                for( var i = 0; i < sheets.length; i++ ){
                    if( sheets[ i ].href && sheets[ i ].href.indexOf( href ) > -1 ){
                        defined = true;
                    }
                }
                if( defined ){
                    ss.media = media || "all";
                }
                else {
                    setTimeout( toggleMedia );
                }
            }
            toggleMedia();
            return ss;
        }
    </script>
</head>
<body>

<div id="app">
    <nav ref="navBar" class="navbar fixed-top navbar-light">
    <div id="global-loading-indicator" class="progress-line global-loading-indicator"></div>
    <div id="nav_background" class="nav-background"></div>
    <div style="padding-left: 15px;padding-right: 15px" class="container container-narrow nav-content">

        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" data-toggle="adropdown">
            <span class="oi" data-glyph="menu"></span>
        </button>
        <a id="nav_title" class="navbar-brand Montserrat" href="/">
            Pride&#39;s Life
        </a>
        <div class="float-right navbar-dark nav-icon-group">
            <div class="dropdown">
                <ul class="dropdown-menu" id="collapsed_nav">
                    <li><a href="/" class="a-block nav-icon">首页</a></li>
                    <li><a href="/archives" class="a-block nav-icon">归档</a></li>
                    
                    
                    
                    <li><a href="/atom.xml" target="_blank" class="a-block">
                            <span data-glyph="rss" class="oi nav-icon"></span>
                        </a>
                    </li>
                    
                </ul>
            </div>

        </div>
    </div>
</nav>
    <div class="container container-narrow">

        <div ref="pageHead"
             v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"
             class="page-head">
            <a href="/">
                <h2>Pride&#39;s Life</h2>
                <h5>虛擬世界日誌</h5>
            </a>
        </div>

<div class="row stream-container">
    <div class="card-container">

        <div class="card card-item clear-border card-top-patch card-clear-hover">
            

            <div class="card-item-container clear-flex-xs">
                <div class="card-inner-cell">
                    <h2>基于okhttp模拟登陆青果教务系统</h2>

                    <div>
                        <p>
                            <time datetime="2018-09-02T07:47:56.000Z" itemprop="datePublished">
                                2018-09-02 15:47
                            </time>
                            

                            
                            
                            <span class="oi" data-glyph="tag" style="vertical-align: middle; margin-left: 5px"> </span>&nbsp;
                            
                            <a href='/tags/Android/'>Android</a>
                            
                            
                            
                        </p>
                    </div>


                    <p class=" post-block-desc">
                        <p>​    学习Android网络编程小半年了，写过一个基于青果教务的登陆app，其中的第一步模拟登陆，诸多课表app也是用的同样技术，不过抓包来看都是本地上传教务系统账号密码（包含验证码），在服务器上进行模拟登陆后取回cookies爬取相应的课程信息。</p>
<p>​    这里简单介绍一下通过<a href="http://square.github.io/okhttp/" target="_blank" rel="noopener">okhttp</a>模拟登陆教务系统的过程和思路，用到的调试工具(Chrome/火狐)。</p>
<p>​    首先进入教务系统网站进行登陆，捕捉登陆回显，和post参数。</p>
<p>​    <strong><u>相关IP及个人信息已做替换处理</u></strong></p>
<p><img src="https://raw.githubusercontent.com/MePride/mepride.github.io/master/2018/09/02/基于okhttp模拟登陆青果教务系统\TIM截图20180902160757.png" alt="TIM截图20180902160757"></p>
<p><img src="https://raw.githubusercontent.com/MePride/mepride.github.io/master/2018/09/02/基于okhttp模拟登陆青果教务系统\TIM截图20180902160917.png" alt="TIM截图20180902160917"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">post参数方面：__VIEWSTATE -&gt; 我也不知道是什么，直接可以在网页源码下获得。</span><br><span class="line"></span><br><span class="line">			typeName -&gt;  字符串“登陆”的一种编码</span><br><span class="line"></span><br><span class="line">			Sel_Type -&gt; 身份选项</span><br><span class="line"></span><br><span class="line">			txt_asmcdefsddsd -&gt; 学号</span><br><span class="line"></span><br><span class="line">			dsdsdsdsdxcxdfgfg、fgfggfdgtyuuyyuuckjg -&gt; 加密后的登陆信息</span><br><span class="line"></span><br><span class="line">			txt_pewerwedsdfsdff、txt_sdertfgsadscxcadsads -&gt; 保持为空</span><br></pre></td></tr></table></figure>
<p>查看_data/home_login.aspx页面源码，由于前端代码的开放性，对登陆信息进行加密的函数直接可以查找到，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkpwd</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.value != <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = md5(<span class="built_in">document</span>.all.txt_asmcdefsddsd.value + md5(obj.value).substring(<span class="number">0</span>, <span class="number">30</span>).toUpperCase() + <span class="string">'10379'</span>).substring(<span class="number">0</span>, <span class="number">30</span>).toUpperCase();</span><br><span class="line">        <span class="built_in">document</span>.all.dsdsdsdsdxcxdfgfg.value = s;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.all.dsdsdsdsdxcxdfgfg.value = obj.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkyzm</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.value != <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> s = md5(md5(obj.value.toUpperCase()).substring(<span class="number">0</span>, <span class="number">30</span>).toUpperCase() + <span class="string">'10379'</span>).substring(<span class="number">0</span>, <span class="number">30</span>).toUpperCase();</span><br><span class="line">        <span class="built_in">document</span>.all.fgfggfdgtyuuyyuuckjg.value = s;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.all.fgfggfdgtyuuyyuuckjg.value = obj.value.toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如此可以直接写一个md5工具类，对数据进行md5加密，并且输出为string：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Md5Util</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMD5</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//生成一个MD5加密计算摘要</span></span><br><span class="line">            MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            <span class="comment">//计算md5函数</span></span><br><span class="line">            md.update(str.getBytes());</span><br><span class="line">            <span class="comment">// digest()最后确定返回md5 hash值，返回值为8为字符串。因为md5 hash值是16位的hex值，实际上就是8位的字符</span></span><br><span class="line">            <span class="comment">// BigInteger函数则将8位的字符串转换成16位hex值，用字符串来表示；得到字符串形式的hash值</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BigInteger(<span class="number">1</span>,md.digest()).toString(<span class="number">16</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>布局（图片素材来源于<a href="www.flaticon.com">flaction</a>）：</p>
<p><img src="https://raw.githubusercontent.com/MePride/mepride.github.io/master/2018/09/02/基于okhttp模拟登陆青果教务系统\TIM截图20180902164101.png" alt="TIM截图20180902164101"></p>
<p>View绑定及一些变量（<a href="http://jakewharton.github.io/butterknife/" target="_blank" rel="noopener">Butterknife</a>）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里使用Butterknife</span></span><br><span class="line"><span class="comment">//在onCreate中进行ButterKnife.bind(this)</span></span><br><span class="line"><span class="meta">@BindView</span>(R.id.et_stuId) EditText stuId;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.et_passWd) EditText passWd;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.et_code) EditText code;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.iv_codeimg) ImageView codeImg;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.btn_login) Button Login;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String codeUrl = <span class="string">"http://·····/sys/ValidateCode.aspx?t=80"</span>;</span><br><span class="line"><span class="keyword">private</span> String loginUrl = <span class="string">"http://·····/_data/home_login.aspx"</span>;</span><br><span class="line"><span class="keyword">private</span> String sessionID;</span><br><span class="line"><span class="keyword">private</span> String stuNumber;</span><br><span class="line"><span class="keyword">private</span> String stuName;</span><br><span class="line"><span class="keyword">private</span> String stuSex;</span><br><span class="line"><span class="keyword">private</span> String stuClass;</span><br></pre></td></tr></table></figure>
<p>功能代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**点击事件**/</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clickEvents</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Login.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (stuId.getText().toString().isEmpty()&amp;&amp;passWd.getText().toString().isEmpty()&amp;&amp;code.getText().toString().isEmpty())&#123;</span><br><span class="line">                    ToastUtil.showToast(LoginActivity.<span class="keyword">this</span>,<span class="string">"请输入登陆信息以及验证码"</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (stuId.getText().toString().isEmpty())&#123;</span><br><span class="line">                    ToastUtil.showToast(LoginActivity.<span class="keyword">this</span>,<span class="string">"请输入学号"</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (passWd.getText().toString().isEmpty())&#123;</span><br><span class="line">                    ToastUtil.showToast(LoginActivity.<span class="keyword">this</span>,<span class="string">"请输入密码"</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (code.getText().toString().isEmpty())&#123;</span><br><span class="line">                    ToastUtil.showToast(LoginActivity.<span class="keyword">this</span>,<span class="string">"请输入验证码"</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    login();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        codeImg.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                getCode();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**登陆教务系统**/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String id = stuId.getText().toString();</span><br><span class="line">    <span class="keyword">final</span> String pw = passWd.getText().toString();</span><br><span class="line">    <span class="keyword">final</span> String cd = code.getText().toString();</span><br><span class="line">    ExecutorService ThreadPool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">                String passwdMd5 = Md5Util.getMD5(id + Md5Util.getMD5(pw).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase()+<span class="string">"10379"</span>).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase();</span><br><span class="line">                String idcodeMd5 = Md5Util.getMD5(Md5Util.getMD5(cd.toUpperCase()).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase()+<span class="string">"10379"</span>).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase();</span><br><span class="line">                RequestBody body = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">                        .add(<span class="string">"__VIEWSTATE"</span>, 这里由于文本太多直接省略)</span><br><span class="line">                        .add(<span class="string">"pcInfo"</span>, <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:59.0) Gecko/20100101 Firefox/59.0"</span>)</span><br><span class="line">                        .add(<span class="string">"typeName"</span>, <span class="string">"%D1%A7%C9%FA"</span>)</span><br><span class="line">                        .add(<span class="string">"dsdsdsdsdxcxdfgfg"</span>, passwdMd5)</span><br><span class="line">                        .add(<span class="string">"fgfggfdgtyuuyyuuckjg"</span>, idcodeMd5)</span><br><span class="line">                        .add(<span class="string">"Sel_Type"</span>, <span class="string">"STU"</span>)</span><br><span class="line">                        .add(<span class="string">"txt_asmcdefsddsd"</span>, id)</span><br><span class="line">                        .add(<span class="string">"txt_pewerwedsdfsdff"</span>, <span class="string">""</span>)</span><br><span class="line">                        .add(<span class="string">"txt_sdertfgsadscxcadsads"</span>, <span class="string">""</span>)</span><br><span class="line">                        .build();</span><br><span class="line">                Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                        .url(loginUrl)</span><br><span class="line">                        .addHeader(<span class="string">"Host"</span>, host-ip)</span><br><span class="line">                        .addHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">                        .addHeader(<span class="string">"Referer"</span>, <span class="string">"http://IP/_data/home_login.aspx"</span>)</span><br><span class="line">                        .addHeader(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:59.0) Gecko/20100101 Firefox/59.0"</span>)</span><br><span class="line">                        .addHeader(<span class="string">"Cookie"</span>,sessionID)</span><br><span class="line">                        .post(body)</span><br><span class="line">                        .build();</span><br><span class="line">                Response response = okHttpClient.newCall(request).execute();</span><br><span class="line">                Document document = Jsoup.parse(response.body().string());</span><br><span class="line">                <span class="keyword">final</span> String result = document.getElementById(<span class="string">"divLogNote"</span>).text();</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"正在加载权限数据..."</span>.equals(result)) &#123;	<span class="comment">//检测文本，检测到为登陆成功</span></span><br><span class="line">                    getStuInfo();</span><br><span class="line">                    Intent intent = <span class="keyword">new</span> Intent(LoginActivity.<span class="keyword">this</span>, HomeActivity.class);</span><br><span class="line">                    startActivity(intent);</span><br><span class="line">                    finish();</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    ToastUtil.showToast(LoginActivity.<span class="keyword">this</span>,result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    ThreadPool.execute(runnable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**取得验证码**/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">            .url(codeUrl)</span><br><span class="line">            .addHeader(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:59.0) Gecko/20100101 Firefox/59.0"</span>)</span><br><span class="line">            .addHeader(<span class="string">"Referer"</span>,loginUrl)</span><br><span class="line">            .build();</span><br><span class="line">    OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">    Call call = okHttpClient.newCall(request);</span><br><span class="line">    call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(LoginActivity.<span class="keyword">this</span>, <span class="string">"网络错误,验证码加载失败"</span>, Toast.LENGTH_SHORT);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">byte</span>[] Imgbyte = response.body().bytes();</span><br><span class="line">            Message message = handler.obtainMessage();</span><br><span class="line">            message.obj = Imgbyte;</span><br><span class="line">            message.what = <span class="number">1</span>;</span><br><span class="line">            handler.sendMessage(message);</span><br><span class="line">            Headers headers = response.headers();</span><br><span class="line">            List&lt;String&gt; cookies = headers.values(<span class="string">"Set-Cookie"</span>);</span><br><span class="line">            String session = cookies.get(<span class="number">0</span>);</span><br><span class="line">            sessionID = session.substring(<span class="number">0</span>,session.indexOf(<span class="string">";"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**Handler刷新**/</span></span><br><span class="line">    <span class="keyword">public</span>  Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message message)</span></span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (message.what)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">byte</span>[] Picture = (<span class="keyword">byte</span>[]) message.obj;</span><br><span class="line">                    Bitmap bitmap = BitmapFactory.decodeByteArray(Picture,<span class="number">0</span>,Picture.length);</span><br><span class="line">                    codeImg.setImageBitmap(bitmap);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>其中这里是对数据进行加密获取post参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String passwdMd5 = Md5Util.getMD5(id + Md5Util.getMD5(pw).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase()+<span class="string">"10379"</span>).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase();</span><br><span class="line">                String idcodeMd5 = Md5Util.getMD5(Md5Util.getMD5(cd.toUpperCase()).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase()+<span class="string">"10379"</span>).substring(<span class="number">0</span>,<span class="number">30</span>).toUpperCase();</span><br></pre></td></tr></table></figure>
<p>测试：<img src="https://raw.githubusercontent.com/MePride/mepride.github.io/master/2018/09/02/基于okhttp模拟登陆青果教务系统\enframe_2018-09-02-16-56-08.png" alt="enframe_2018-09-02-16-56-08"></p>

                    </p>

                    <nav class="pagination" role="pagination">
    
    <span class="page-number"></span>
    
</nav>

                    
                </div>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>
        &copy;&nbsp;2018&nbsp;<a target="_blank"
                                                               href="">Pride</a>
    </p>

    
    <p>Theme&nbsp;<a target="_blank"
                     href="https://github.com/SumiMakito/hexo-theme-journal">Journal.</a>&nbsp;by&nbsp;<a
                target="_blank" href="https://www.keep.moe">Makito</a>
    </p>
    

    <p>
        Proudly published with&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>
    </p>
</footer>

</div>
</div>
</div>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src=" /js/vue.min.js"></script>
<script src=" /js/journal.js"></script>
<script>
    loadCSS("//fonts.googleapis.com/css?family=Source+Sans+Pro:400|Montserrat|Anonymous+Pro:400|Material+Icons");
</script>


<script>
    $(document).ready(function () {
        $("#global-loading-indicator").fadeOut(600);
    });
</script>

</body>
</html>
