<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="咸鱼的开发日誌"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>一个无趣的小程序Demo - Pride's</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="https://i.loli.net/2018/09/04/5b8e619c41726.png"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/MePride"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="https://i.loli.net/2018/09/04/5b8e64ca934c8.jpg"><div class="post-title"><h1 class="title">一个无趣的小程序Demo</h1><ul class="meta"><li><i class="icon icon-author"></i>Pride</li><li><i class="icon icon-clock"></i>21 Minutes</li><li><i class="icon icon-calendar"></i>2018年11月9日</li></ul></div></div><div class="article-content" style="max-width:800px"><p>​    第一次接触微信小程序，这里要讲起一个小故事。某日看到Z君手机上有个正在开发的小程序，内容大致是一个O2O电脑上门维修的小程序，于是简单看了下Z君写的小程序，和Z君讨论起这个小程序的实现思路和过程(此时Z君的小程序只有一个UI,且无服务器)。于是想到用了<a href="www.bmob.cn">Bmob后端云</a>(<a href="http://doc.bmob.cn/data/wechat_app_new/index.html" target="_blank" rel="noopener">官方文档</a>)。</p>
<p>最后的实现方法是提交六组数据，如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">name</th>
<th style="text-align:center">type</th>
<th style="text-align:center">necessary</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">pic</td>
<td style="text-align:center">File</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:center">userName</td>
<td style="text-align:center">String</td>
<td style="text-align:center">true</td>
</tr>
<tr>
<td style="text-align:center">phoneNum</td>
<td style="text-align:center">String</td>
<td style="text-align:center">true</td>
</tr>
<tr>
<td style="text-align:center">userQQ</td>
<td style="text-align:center">String</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:center">time</td>
<td style="text-align:center">String</td>
<td style="text-align:center">false</td>
</tr>
<tr>
<td style="text-align:center">describe</td>
<td style="text-align:center">String</td>
<td style="text-align:center">true</td>
</tr>
</tbody>
</table>
<p> 实现过程:</p>
<p>初始化Bmob -&gt; 获取页面的表单数据 -&gt; 创建Bmob表单数据 -&gt; (若图片存在 -&gt; 建立file写入图片 -&gt;) 将页面数据填入表单中 -&gt; 上传至Bmob</p>
<p><a href="https://github.com/MePride/WechatFeedBack" target="_blank" rel="noopener">Github</a></p>
<p>布局wxml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">loading</span> <span class="attr">hidden</span>=<span class="string">"&#123;&#123;loading&#125;&#125;"</span>&gt;</span></span><br><span class="line">  页面初始化中...</span><br><span class="line"><span class="tag">&lt;/<span class="name">loading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">bindsubmit</span>=<span class="string">"sendNewMood"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"add_pic"</span> <span class="attr">bindtap</span>=<span class="string">"uploadPic"</span> <span class="attr">wx-if</span>=<span class="string">"&#123;&#123;!isSrc&#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>添加图片（选）<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;isSrc&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"image_box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>  <span class="attr">class</span>=<span class="string">"picPre"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;src&#125;&#125;"</span>  <span class="attr">mode</span>=<span class="string">"aspectFill"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">"clearPic"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"姓名(必填)"</span>  <span class="attr">class</span>=<span class="string">"add_name"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">bindinput</span>=<span class="string">"setName"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"联系电话(必填)"</span>  <span class="attr">class</span>=<span class="string">"add_phone"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">bindinput</span>=<span class="string">"setPhone"</span> <span class="attr">name</span>=<span class="string">"phone"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"联系QQ(选填)"</span>  <span class="attr">class</span>=<span class="string">"add_qq"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">bindinput</span>=<span class="string">"setQQ"</span> <span class="attr">name</span>=<span class="string">"qq"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"预约时间(选填)"</span>  <span class="attr">class</span>=<span class="string">"add_time"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">bindinput</span>=<span class="string">"setTime"</span> <span class="attr">name</span>=<span class="string">"time"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>  <span class="attr">class</span>=<span class="string">"addConent"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span>  <span class="attr">placeholder</span>=<span class="string">"问题描述(必填)"</span> <span class="attr">maxlength</span>=<span class="string">"1000"</span>  <span class="attr">value</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">bindinput</span>=<span class="string">"setContent"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">'feedBack'</span> <span class="attr">loading</span>=<span class="string">"&#123;&#123;isLoading&#125;&#125;"</span> <span class="attr">hover-start-time</span>=<span class="string">"200"</span> <span class="attr">disabled</span>=<span class="string">"&#123;&#123;isdisabled&#125;&#125;"</span> <span class="attr">formType</span>=<span class="string">"submit"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>部分主要代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/feedback/feedback.js</span></span><br><span class="line"><span class="keyword">var</span> Bmob = <span class="built_in">require</span>(<span class="string">"../../dist/Bmob.js"</span>);			    	<span class="comment">//载入Bmob</span></span><br><span class="line">Bmob.initialize(<span class="string">"你的Application ID"</span>, <span class="string">"你的REST API Key"</span>);	  <span class="comment">//初始化</span></span><br><span class="line"><span class="keyword">var</span> common = <span class="built_in">require</span>(<span class="string">'../../utils/getCode.js'</span>)</span><br><span class="line"><span class="keyword">var</span> that;</span><br><span class="line">Page(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    name:<span class="string">''</span>,<span class="attr">phone</span>:<span class="string">''</span>,<span class="attr">qq</span>:<span class="string">''</span>,<span class="attr">time</span>:<span class="string">''</span>,<span class="attr">content</span>:<span class="string">''</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad:<span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">    that = <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  onReady:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    wx.hideToast()</span><br><span class="line">  &#125;,</span><br><span class="line">  onShow:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> myInterval = setInterval(getReturn, <span class="number">500</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getReturn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      wx.getStorage(&#123;</span><br><span class="line">        key: <span class="string">'user_openid'</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">ress</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (ress.data) &#123;</span><br><span class="line">            clearInterval(myInterval)</span><br><span class="line">            that.setData(&#123;</span><br><span class="line">              loading: <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  uploadPic:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    wx.chooseImage(&#123;</span><br><span class="line">      count:<span class="number">1</span>,<span class="comment">//默认为9</span></span><br><span class="line">      sizeType:[<span class="string">'original'</span>,<span class="string">'compressed'</span>],</span><br><span class="line">      sourceType:[<span class="string">'album'</span>,<span class="string">'camera'</span>],</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tempFilePaths = res.tempFilePaths</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          isSrc:<span class="literal">true</span>,</span><br><span class="line">          src:tempFilePaths</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  clearPic:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//删除图片</span></span><br><span class="line">    that.setData(&#123;</span><br><span class="line">      isSrc:<span class="literal">false</span>,</span><br><span class="line">      src:<span class="string">""</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  feedBack:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Feedback = Bmob.Object.extend(<span class="string">"feedback"</span>);</span><br><span class="line">    <span class="keyword">var</span> feedback = <span class="keyword">new</span> Feedback();</span><br><span class="line">    <span class="keyword">if</span> (that.data.name == <span class="string">""</span> || that.data.phone == <span class="string">""</span> || that.data.content == <span class="string">""</span>) &#123;</span><br><span class="line">      common.dataLoading(<span class="string">"请按规范填写"</span>, <span class="string">"loading"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> Feedback = Bmob.Object.extend(<span class="string">"feedback"</span>);</span><br><span class="line">      <span class="keyword">var</span> feedback = <span class="keyword">new</span> Feedback();</span><br><span class="line">      feedback.set(<span class="string">"name"</span>, that.data.name);</span><br><span class="line">      feedback.set(<span class="string">"phone"</span>, that.data.phone);</span><br><span class="line">      feedback.set(<span class="string">"qq"</span>, that.data.qq);</span><br><span class="line">      feedback.set(<span class="string">"time"</span>, that.data.time);</span><br><span class="line">      feedback.set(<span class="string">"content"</span>, that.data.content);</span><br><span class="line">      <span class="keyword">if</span> (that.data.isSrc == <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> picName = that.data.src;</span><br><span class="line">        <span class="keyword">var</span> file = <span class="keyword">new</span> Bmob.File(name, that.data.src);</span><br><span class="line">        file.save;</span><br><span class="line">        feedback.set(<span class="string">"pic"</span>, file);</span><br><span class="line">      &#125;</span><br><span class="line">      feedback.save(<span class="literal">null</span>, &#123;</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">          wx.navigateBack(&#123;</span><br><span class="line">            </span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="built_in">console</span>.log(result);</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span> (<span class="params">object, error</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><a href="https://i.loli.net/2018/11/10/5be6aa9d5bc65.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/10/5be6aa9d5bc65.png" alt="TIM截图20181110175237.png"></a><br><a href="https://i.loli.net/2018/11/10/5be6aa9d5d4f2.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2018/11/10/5be6aa9d5d4f2.png" alt="TIM截图20181110175247.png"></a></p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">1</span></li></ul></div></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cjsh2wuup0001mcwn7vhibq2p" data-title="一个无趣的小程序Demo" data-url="http://yoursite.com/2018/11/09/一个无趣的小程序Demo/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2019/01/16/写一个馆藏查询app吧/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/10/28/这是一篇正经的ArchLinux安装指南/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/MePride" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="https://segmentfault.com/u/pride" title="SegmentFault" target="_blank"><i class="icon icon-segmentfault"></i></a></li><li><a href="8425284@qq.com" title="Email" target="_blank"><i class="icon icon-email"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2019 Pride's<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>